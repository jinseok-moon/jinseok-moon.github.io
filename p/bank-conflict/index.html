<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Bank Conflicts When you study CUDA, you naturally end up studying shared memoryand along the way you will encounter bank conflicts. A bank conflict occurs when multiple memory requests from a warp are mapped to the same memory bank at the same time.\nShared memory is composed of 32 memory modules (banks), each 32 bits wide. If we place 64 fp32 values into SRAM, they are distributed as shown below: each value is assigned sequentially across the 32 banks.\n"><title>Shared memory: bank conflicts</title><link rel=canonical href=https://jinseok-moon.github.io/p/bank-conflict/><link rel=stylesheet href=/scss/style.min.44c91e7e98aee33a9cb385aa3c14716697fe72e9c673e06c0b7b2b5084608b31.css><meta property='og:title' content="Shared memory: bank conflicts"><meta property='og:description' content="Bank Conflicts When you study CUDA, you naturally end up studying shared memoryand along the way you will encounter bank conflicts. A bank conflict occurs when multiple memory requests from a warp are mapped to the same memory bank at the same time.\nShared memory is composed of 32 memory modules (banks), each 32 bits wide. If we place 64 fp32 values into SRAM, they are distributed as shown below: each value is assigned sequentially across the 32 banks.\n"><meta property='og:url' content='https://jinseok-moon.github.io/p/bank-conflict/'><meta property='og:site_name' content='Jinseok Moon'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2024-12-02T00:00:00+00:00'><meta property='article:modified_time' content='2024-12-02T00:00:00+00:00'><meta name=twitter:title content="Shared memory: bank conflicts"><meta name=twitter:description content="Bank Conflicts When you study CUDA, you naturally end up studying shared memoryand along the way you will encounter bank conflicts. A bank conflict occurs when multiple memory requests from a warp are mapped to the same memory bank at the same time.\nShared memory is composed of 32 memory modules (banks), each 32 bits wide. If we place 64 fp32 values into SRAM, they are distributed as shown below: each value is assigned sequentially across the 32 banks.\n"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><div class=site-meta><h1 class=site-name><a href=/>Jinseok Moon</a></h1><h2 class=site-description>GPU Software Engineer</h2></div></header><ol class=menu-social><li><a href=https://www.github.com/jinseok-moon target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/jinseok-moon target=_blank title=LinkedIn rel=me><svg class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="2"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#bank-conflicts>Bank Conflicts</a></li><li><a href=#experiment>Experiment</a><ol><li><a href=#kernel-0-ideal-case>Kernel 0: ideal case</a></li><li><a href=#kernel-1-bank-conflicts-case>Kernel 1: bank conflicts case</a></li><li><a href=#kernel-2-good-case>Kernel 2: good case</a></li><li><a href=#kernel-3-dram-load-overhead-case>Kernel 3: DRAM load overhead case</a></li></ol></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#how-about-fp64>How about fp64?</a></li><li><a href=#references>References</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/cuda/ style=background-color:#2a9d8f;color:#fff>cuda</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/bank-conflict/>Shared memory: bank conflicts</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2024-12-02T00:00:00Z>Dec 02, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>4 minute read</time></div></footer><footer class=article-translations><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://jinseok-moon.github.io/ko/p/bank-conflict/ class=link>Korean</a></div></footer></div></header><section class=article-content><h2 id=bank-conflicts>Bank Conflicts</h2><p>When you study CUDA, you naturally end up studying shared memoryand along the way you will encounter <code>bank conflicts</code>. A bank conflict occurs when multiple memory requests from a warp are mapped to the same memory bank at the same time.</p><p><img src=/images/image.png loading=lazy></p><p><img src=/images/image-1.png loading=lazy></p><p><img src=/images/image-2.png loading=lazy></p><p>Shared memory is composed of 32 memory modules (banks), each 32 bits wide. If we place 64 fp32 values into SRAM, they are distributed as shown below: each value is assigned sequentially across the 32 banks.</p><p><img src=/images/image-3.png loading=lazy></p><p>When each thread accesses a different bank (cases 1 and 2 in the diagram), there is no bank conflict. In case 3, bank conflicts <em>may</em> occurand we need to distinguish between two sub-cases:</p><ul><li>Threads access the same address in the same bank: for example, threads 0–7 all access element 0 in SRAM. This is treated as a broadcast access, so no bank conflict occurs. A single memory request satisfies all 32 threads. (You can think of a memory request as operating on 128-byte units.)</li><li>Threads access different addresses in the same bank: for example, threads 0–3 access element 0 in SRAM and threads 4–7 access element 32. In this case, the first memory request cannot also fetch the data at address 32, because bank 0 is already busy returning address 0. An additional memory request is required, which serializes the accesses and hurts performance. This situation is what we call a bank conflict.</li></ul><h2 id=experiment>Experiment</h2><p>To see how this behaves in practice, we can run the following four kernels. They operate on a 32×32 matrix; for simplicity the figures illustrate the 8×8 case. The data is stored in row-major order.</p><p><img src=/images/image-4.png loading=lazy></p><h3 id=kernel-0-ideal-case>Kernel 0: ideal case</h3><p>Kernel 0 is the ideal case. The 32 threads in a warp sequentially load elements 0–31 from the input in DRAM and store them into addresses 0–31 in SRAM. Then they read those values back from SRAM and write them to addresses 0–31 in the output in DRAM.</p><p><img src=/images/image-5.png loading=lazy></p><h3 id=kernel-1-bank-conflicts-case>Kernel 1: bank conflicts case</h3><p>Kernel 1 is written to intentionally create bank conflicts. It loads data from DRAM and forces all accesses to go through bank 0 in SRAM. As a result, there are 31 bank conflicts, which means the warp is effectively split into 32 serialized wavefronts.</p><p><img src=/images/image-6.png loading=lazy></p><h3 id=kernel-2-good-case>Kernel 2: good case</h3><p>In kernel 2, each thread accesses a different bank, but the addresses in DRAM are not contiguous. This is still fine: each memory controller is responsible for its own region of memory and can service those requests independently, so there is no performance penalty from bank conflicts. However, the indexing pattern is somewhat artificial and not always practical in real kernels — hence it is a “good case” mainly from the bank-conflict perspective.</p><p><img src=/images/image-7.png loading=lazy></p><h3 id=kernel-3-dram-load-overhead-case>Kernel 3: DRAM load overhead case</h3><p>This case illustrates how important DRAM memory coalescing is. It is similar to kernel 2, but when loading from DRAM each thread fetches data from a different sector. In the coalesced case, 32 threads accessing contiguous fp32 values need only 4 sectors (4 bytes × 32 = 128 bytes). In this kernel, only 4 bytes per sector are actually useful. The hardware can still service four sectors per memory transaction, so we end up with 8 wavefronts, but overall we read 1024 bytes of DRAM to use only 128 bytes of data, which clearly degrades performance.</p><p><img src=/images/image-8.png loading=lazy></p><h2 id=conclusion>Conclusion</h2><p>As these four kernels show, an essential part of CUDA programming is arranging data so that it can be processed efficiently in bulk. By carefully choosing the data layout and access patterns, you can avoid bank conflicts and prevent unnecessary performance loss.</p><h2 id=how-about-fp64>How about fp64?</h2><p>As an aside, how does this work for fp64 data, given that the SRAM bank size is 4 bytes? Assuming aligned and coalesced memory accesses, the memory controller is designed to split a 256-byte fp64 transaction into two 128-byte requests. In this setup, bank conflicts do not occur, even though each value is 64 bits.</p><h2 id=references>References</h2><ol><li><a class=link href=https://forums.developer.nvidia.com/t/requesting-clarification-for-shared-memory-2024-12-02-bank-conflicts-and-shared-memory-access/268574/3 target=_blank rel=noopener>https://forums.developer.nvidia.com/t/requesting-clarification-for-shared-memory-2024-12-02-bank-conflicts-and-shared-memory-access/268574/3</a></li></ol></section><footer class=article-footer></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=[".main-article",".widget--toc"];e.forEach(e=>{const t=document.querySelector(e);t&&renderMathInElement(t,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/cuda-tile/><div class=article-details><h2 class=article-title>CUDA Tile IR, cuTile Python</h2></div></a></article><article><a href=/p/archs/><div class=article-details><h2 class=article-title>GPU architecture w/ LLM</h2></div></a></article><article><a href=/p/gemm-2/><div class=article-details><h2 class=article-title>GEMM 2</h2></div></a></article><article><a href=/p/gemm-1/><div class=article-details><h2 class=article-title>GEMM 1</h2></div></a></article><article><a href=/p/thread-indexing/><div class=article-details><h2 class=article-title>Proper thread indexing and memory coalescing</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//myblog-otcr7pydaj.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2024 -
2026 Jinseok Moon</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.33.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>